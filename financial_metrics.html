
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Calculations with Plotly</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Financial Calculations with Adjustable Parameters</h1>
    <div>
        <label for="discountRate">Discount Rate:</label>
        <input type="number" id="discountRate" name="discountRate" value="0.05" step="0.01" min="0" max="1" oninput="updateChart()">
    </div>
    <div>
        <label for="annualCost">Annual Cost:</label>
        <input type="number" id="annualCost" name="annualCost" value="30" step="1" min="0" oninput="updateChart()">
    </div>
    <div id="netCashFlowChart"></div>
    <div id="cumulativeCashFlowChart"></div>

    <script>
        function calculateFinancialMetrics(discountRate, annualCost) {
            let periods = Array.from({ length: 21 }, (_, i) => i);
            let cashInflows = [0].concat(Array(20).fill(279));
            let cashOutflows = [600].concat(Array(20).fill(annualCost));

            let netCashFlow = cashInflows.map((inflow, i) => inflow - cashOutflows[i]);
            let discountedNetCashFlow = netCashFlow.map((flow, i) => flow / Math.pow(1 + discountRate, periods[i]));
            let cumulativeDiscountedCashFlow = discountedNetCashFlow.reduce((acc, val, i) => [...acc, (acc[i - 1] || 0) + val], []);

            return {
                periods,
                netCashFlow,
                cumulativeDiscountedCashFlow
            };
        }

        function updateChart() {
            let discountRate = parseFloat(document.getElementById('discountRate').value);
            let annualCost = parseFloat(document.getElementById('annualCost').value);

            let metrics = calculateFinancialMetrics(discountRate, annualCost);

            let netCashFlowTrace = {
                x: metrics.periods,
                y: metrics.netCashFlow,
                name: 'Net Cash Flow',
                type: 'bar'
            };

            let cumulativeDiscountedCashFlowTrace = {
                x: metrics.periods,
                y: metrics.cumulativeDiscountedCashFlow,
                name: 'Discounted Cumulative Cash Flow',
                type: 'scatter',
                mode: 'lines+markers'
            };

            let netCashFlowData = [netCashFlowTrace];
            let cumulativeCashFlowData = [cumulativeDiscountedCashFlowTrace];

            let netCashFlowLayout = {
                title: 'Net Cash Flow',
                xaxis: { title: 'Period' },
                yaxis: { title: 'Amount' },
                barmode: 'group'
            };

            let cumulativeCashFlowLayout = {
                title: 'Cumulative Cash Flows',
                xaxis: { title: 'Period' },
                yaxis: { title: 'Amount' }
            };

            Plotly.newPlot('netCashFlowChart', netCashFlowData, netCashFlowLayout);
            Plotly.newPlot('cumulativeCashFlowChart', cumulativeCashFlowData, cumulativeCashFlowLayout);
        }

        updateChart();
    </script>
</body>
</html>
